# 상태정보 유지기술 : 쿠키, 세션

- 장바구니
- 팝업창 오늘 하루만 안보기

- 여러번의 요청이 일어나도 자신의 어떤 상태 및 값을 유지하고 싶은 기술


## 쿠키 : Cookie

- jsp 공유영역에 저장된 값들은 모두 서버단이 기억을 하고 있는 것이었다. 

- 그럼 쿠키는 어디에 저장되어 기억되는 것일까?

- 쿠키는 정보를 `사용자의 컴퓨터에 저장`을 시키는 것이다.

- 장점 : 
  - 서버에 저장되지 않기 때문에 서버에 대한 부하는 가중되지 않는다.

  - 정보저장 유효기간을 사용자가 설정할 수 있다.

  - 브라우저가 닫힌 이후에도 값을 유지할 수 있다. 

- 단점 : 
  - 사용자의 컴퓨터는 보안이 떨어지기 때문에 보안상의 문제가 발생할 수 있다. 그래서 일반적인 회사에서는 쿠키 사용을 금지한다. 

  - 메모리의 부하가 발생할 수 있기 때문에 한 사이트에서 저장할 수 있는 쿠키 객체는 20개로 한정되어 있다. 
  
  - 전체 한 컴퓨터에 저장할 수 있는 쿠키의 갯수는 최대 300개이고, 용량 한계는 4k이다.


- 쿠키에 저장할 수 있는 정보는 `문자열만` 가능하다.

- 한글 저장 시에는 반드시 인코딩을 해야 한다. 



## 쿠키의 동작 방식

- 쿠키를 만드는 행위는 서버가 담당하는 것이다. 

- 서버는 클라이언트에게 응답할 때 활용하는 response 객체를 통해 쿠키를 담아 쿠키저장소에 쿠키를 저장하게 된다.  

- 저장된 쿠키는 쿠키 저장소에 있다가 사용자가 웹사이트를 요청할 때, 해당 웹사이트와 관련된 쿠키를 뽑아내서 request 객체에 쿠키들을 얹어 보낸다. 

![image](https://user-images.githubusercontent.com/77392444/123569246-f364c800-d800-11eb-9773-8e313d7c8458.png)


## 쿠키의 생성

- 쿠키 생성 및 쿠키 저장소에 전달

```jsp
<%
  Cookie cookie = new Cookie("cookieName","cookieValue"); // 쿠키 생성
  response.addCookie(cookie); // 쿠키 저장소에 전달
%>
```


- 쿠키 객체 얻어오기 : 최대 20개가 있기 때문에 복수 객체를 받아와야 한다. 

```jsp
<%
  Cookie[] cookies = request.getCookies();
%>
```

- 쿠키 객체 중요 API

|메서드|리턴타입|설명|
|---------|------|----------------------|
|getName()|String|쿠키의 이름을 추출한다.|
|getValue()|String|쿠키의 값을 추출한다.|


- 개발자도구에서 쿠키 확인하기

![image](https://user-images.githubusercontent.com/77392444/123570510-522b4100-d803-11eb-822b-4087e9a06067.png)


## 쿠키의 구성

- 구성요소

- 쿠키 이름 제약 조건

  - ASCII 코드의 알파벳과 숫자만을 사용할 수 있다. (한글은 제약조건 위배로 오류!)
  - 콤마, 세미콜론, 공백 등의 문자를 사용할 수 없다. 
  - `$` 로 시작할 수 없다. 

- 한글 처리를 위해서는 인코딩, 디코딩을 해줘야 한다. 

  - `cName = URLEncoder.encode(cName, "utf-8");`
  - `cName = URLDecoder.decode(cName, "utf-8");`


- 쿠키의 유효시간

  - 초 단위 설정 : `Cookie.setMaxAge(int maxAge)`
  
  - 유효시간 미 설정 시, 웹 브라우저 닫을 때 쿠키도 함께 삭제된다. 
  
  
- 쿠키의 도메인



- 쿠키 경로
  - 설정된 경로를 기준으로 쿠키 전달
  - `Cookie.setPath(String path)`
  - 미 설정 시, 요청 URL경로에 대해서만 쿠키 전달
  - 경로 설정 시, 설정한 경로 및 그 하위 경로에 대해서 쿠키 전송


